# Kafka知识点梳理

## 一、Kafka和消息队列的特点

### 1. kafka定义

Kafka是一个基于发布订阅模式的分布式消息队列，它具有以下特点：

- 支持消息的发布和订阅，类似于 RabbtMQ、ActiveMQ 等消息队列；
- 支持数据实时处理；
- 能保证消息的可靠性投递；
- 支持消息的持久化存储，并通过多副本分布式的存储方案来保证消息的容错；
- 高吞吐率，单 Broker 可以轻松处理数千个分区以及每秒百万级的消息量。

### 2. 消息队列的优点

* **解耦：**两边数据处理过程独立，可任意修改，只要遵从相同的接口约束

* **可恢复性：**系统的一部分组件失效时，不会影响到整个系统。即使一个处理消息的进程挂掉，加入队列中的消息仍可在系统恢复后处理

* **缓冲：**控制优化数据流经过系统的速度，解决生产消费速度不一致的问题

* **削峰平谷：**访问量剧增的情况可以避免系统因超负荷的请求而崩溃

* **异步通信：**提供了异步处理机制

### 3. 消息对列的两种模式

#### 3.1 点对点模式

消费者主动拉取数据，消息收到后清除

#### 3.2 发布/订阅模式

生产者将消息发布到topic中，同时有多个消费者订阅该消息

### 4. Kafka中的基本概念

#### 4.1 消息、批次

Kafka中的基本数据单元称为消息（Message）在磁盘中保存为log， 为减少网络开销，提高效率，**多个消息会被放入同一批次 (Batch) 中后再写入** 

#### 4.2 主题、分区、副本

Kafka中的消息根据主题（Topic）来分类，每个主题又分为不同的分区（Partition），每个分区可以有多个副本（Replica）。每个分区中消息的内容不同，不同分区可以部署在不同的服务器上，每个分区也可以有多份副本，分为Leader和Follower，每个副本必须放在不同的服务器中，保证集群中的某个节点发生故障时，该节点上的 partition 数据不丢失 。但由于**消息保存在不同的分区中，也就无法实现整个主题中消息的有序，只在分区内保证有序性**。

#### 4.3 生产者、消费者、消费者组

生产者（Producer）既是向Kafka集群发送消息的客户端

消费者（Consumer）既是向Kafka集群拉取消息的客户端

消费者组（Consumer Group）有多个消费者组成，**消费者组中每个消费者负责消费不同的分区，不可重复消费。**

#### 4.4 Broker、集群

每一台独立的Kafka服务器均被称为Broker，有不同的BrokerId。

集群（Cluster）由Broker组成，每个集群都有一个Controller负责将分区分配给Broker和监控Broker。

## 二、Kafka生产者





